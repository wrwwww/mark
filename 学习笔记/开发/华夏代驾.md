# 环境配置

## 安装CentOS

## 配置Docker

```
// 设置自启动
# mysql
docker update mysql --restart=always

# redis
docker update redis --restart=always
```

### 设置内网ip

为了给docker中的容器分配固定的内网ip,新建网段

```
docker network create --subnet=172.18.0.0/18 mynet
```

  

docker run 是创建容器的命令

```
docker run -it -d --name mysql_1 -p 12001:3306 \
--net mynet --ip 172.18.0.2 \
-m 400m -v /root/mysql_1/data:/var/lib/mysql \
-v /root/mysql_1/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23 \
--lower_case_table_names=1
```

```
docker run -it -d --name mysql_2 -p 12002:3306 \
--net mynet --ip 172.18.0.3 \
-m 400m -v /root/mysql_2/data:/var/lib/mysql \
-v /root/mysql_2/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23  \
--lower_case_table_names=1
```

```
docker run -it -d --name mysql_3 -p 12003:3306 \
--net mynet --ip 172.18.0.4 \
-m 400m -v /root/mysql_3/data:/var/lib/mysql \
-v /root/mysql_3/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23  \
--lower_case_table_names=1
```

  

```
docker run -it -d --name mysql_4 -p 12004:3306 \
--net mynet --ip 172.18.0.5 \
-m 400m -v /root/mysql_4/data:/var/lib/mysql \
-v /root/mysql_4/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23  \
--lower_case_table_names=1
```

  

```
docker run -it -d --name mysql_5 -p 12005:3306 \
--net mynet --ip 172.18.0.6 \
-m 300m -v /root/mysql_5/data:/var/lib/mysql \
-v /root/mysql_5/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23  \
--lower_case_table_names=1
```

```
export http_proxy=http://192.168.31.105:7897
export https_proxy=http://192.168.31.105:7897
```

```
docker run -it -d --name jdk15 -p 3307:3307 \
--net mynet --ip 172.18.0.7 \
-m 400m -v /root/shardingSphere:/root/shardingSphere \
-e TZ=Asia/Shanghai --privileged=true \
openjdk bash 
```

解压shardingSphere.tar.gz

```
yum install unzip -y

cd shardingSphere/bin
chmod -R 777 ./*

docker exec -it jdk15 bash

cd /root/shardingSphere/bin

./start.sh
```

  

```
net:
  port: 27017
  bindIp: "0.0.0.0"
storage:
  dbPath: "/data/db"
security:
  authorization: enabled

```

```
docker run -it -d --name mongo -p 27017:27017 \
--net mynet --ip 172.18.0.8 \
-m 400m -v /root/mongo:/etc/mongo \
-v /root/mongo/data/db:/data/db \
-e MONGO_INITDB_ROOT_USERNAME=admin \
-e MONGO_INITDB_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true  \
docker.io/mongo --config /etc/mongo/mongod.conf
```

### 创建角色以及密码

```
# 进入到后端的shell中
docker exec -it 容器ID mongo
use admin
db.createUser({user: "root", pwd: "", roles:[{role: "root", db:"admin"}]})
```

```
bind 0.0.0.0
protected-mode yes
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 0
loglevel notice
logfile ""
databases 12
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir ./
requirepass 1234
```

```
docker run -it -d --name redis -p 6379:6379 \
--net mynet --ip 172.18.0.9 \
-m 200m -v /root/redis/conf:/usr/local/etc/redis \
-e TZ=Asia/Shanghai --privileged=true  \
redis /usr/local/etc/redis/redis.conf
```

minio对象存储服务

```
docker pull bitnami/minio
mkdir /root/minio/data
chmod -R 777 /root/minio/data
```

```
// 注意密码和用户名太短会无法启动
// MINIO_ROOT_USER	MinIO root user name.	minio
//MINIO_ROOT_PASSWORD	Password for MinIO root user.	miniosecret
docker run -it -d --name minio -p 9000:9000 \
 -p 9001:9001 --net mynet --ip 172.18.0.10 \
-m 400m -v /root/minio/data:/data \
-e TZ=Asia/Shanghai --privileged=true  \
minio 
```

rabbitmq 消息中间件

```
docker run -it -d --name mq -p 5672:5672 -p 15672:15672 \
--net mynet --ip 172.18.0.11 \
-m 200m \
-e TZ=Asia/Shanghai --privileged=true  \
rabbitmq:3-management
```

nacos注册中心

```
docker pull nacos/nacos-server

docker run -it -d --name nacos -p 8848:8848 -p 9848:9848 \
--net mynet --ip 172.18.0.12  --env MODE=standalone \
--name nacos \
-e TZ=Asia/Shanghai --privileged=true  \
nacos/nacos-server
```

sentinel

```
docker run -it -d --name sentinel -p 8858:8858 \
-p 8719:8719 --net mynet --ip 172.18.0.13  \
-m 200m \
-e TZ=Asia/Shanghai \
-d bladex/sentinel-dashboard
```

```
docker run -it -d --name mysql_emos -p 13007:3306 \
--net mynet --ip 172.18.0.20 \
-m 300m -v /root/emos/mysql/data:/var/lib/mysql \
-v /root/mysql_5/config:/etc/mysql/conf.d \
-e MYSQL_ROOT_PASSWORD=1234 \
-e TZ=Asia/Shanghai --privileged=true \
mysql:8.0.23  \
--lower_case_table_names=1
```

## 数据库设计

### 订单表

**字段设计**

| 字段  | 数据类型 |     | 备注  |
| --- | ---- | --- | --- |
|     |      |     |     |

**sql**

```sql


```