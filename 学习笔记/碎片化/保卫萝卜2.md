## dex修改

通过jadx对apk反编译进行静态分析，最终定位到payhelper类中的方法cb_bbc，该方法为选择支付方式并传入商品信息，这是已修改版本，通过后续代码分析找到了商品下发代码为

```
-- 其中i2为函数传入的商品代码
ShareHelper.bbs(true, i2);
```

![](lake%20import/计算机/Attachments/1748483084824-acab92db-5477-4059-8b43-584940b55834.png)

修改打包后，安装运行，游戏卡在第一屏。通过查看logcat日志定位到，猜测是修改dex导致dex的md5值不是原来的，需要找到该日志打印的方法

```
05-23 20:31:27.473 13424 13468 D cocos2d-x debug info: ----------strCurMd5 : ae79542eedc8a3bd972936ac67275064----------
05-23 20:31:27.474 13424 13468 D cocos2d-x debug info: ----------strVefMd5 : 250226d88f94bd3f5955ce17a6617200----------
05-23 20:31:27.474 13424 13468 D cocos2d-x debug info: =============b_c:ae79542eedc8a3bd972936ac67275064_250226d88f94bd3f5955ce17a6617200===============
```

## so修改

### dex md5 校验分析

通过分析libgame.so，直接搜索string cur 找到

![](https://cdn.nlark.com/yuque/0/2025/png/23135285/1748483427889-fb37ff4f-7ae5-423a-b737-9c0f391652cb.png)

是格式化的字符串，可以大胆猜测与这段代码有关系，

![](lake%20import/计算机/Attachments/1748483517633-b9be8ff6-2e74-41ee-9da2-2becc53ee0a1.png)

同时看到了上面出现的字符串`**b_c:**`，找对地方了，接下来`ctrl+x`查看字符串被引用的地址，找到两个地址

![](lake%20import/计算机/Attachments/1748483627513-ce7b690a-4b80-4007-9b62-ac8422848653.png)

进入第一个地址函数，在函数的开头，出现了两天硬编码的字符串，通过ai查看代码，猜测可能是base64编码的字符串，`Y2xhc3Nlcy5kZXg=`与`Y2ZnLmRleA==`，分别是`classes.dex`与`cfg.dex`，看来是classes.dex校验的相关部分，查看cfg.dex没有找到相关打开查看方式，代码 中的加解密逻辑也没有看懂，想着逃过校验逻辑，使得游戏直接加载，后来通过比较修改与未修改apk，发现打印b_c分支的函数，是失败卡屏后走的逻辑，所以考虑，跳过这部分逻辑的执行。使用无条件跳转指定，使其始终跳转到正确的游戏逻辑，nop掉不合理分支，最终游戏成功修改运行。并附上修改成功的截图。

![](lake%20import/计算机/Attachments/1748484162458-e60daebf-821e-484f-ba8b-ea14ba065c85.png)

### 实名校验去除

  

### 注入直装apk

  

### 修改包名实现共存

  

## 学习到的知识

### 命令

```
-- 查看应用程序的入口活动
adb shell cmd package resolve-activity --brief com.carrot.iceworld
adb shell dumpsys package <包名> | grep -A 10 "android.intent.action.MAIN"

-- 命令行启动应用程序
adb shell am start -n com.carrot.iceworld/.MainActivity

-- 命令行查看应用程序的pid
adb shell pidof com.carrot.iceworld  
-- 命令行查看应用程序的日志
adb shell logcat --pid 
```